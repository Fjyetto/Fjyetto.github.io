<!DOCTYPE html>
<html>
	<head>
		<title>Peter Griffin</title>
	</head>
	<body style="display:flex; justify-content: space-around; align-items: center; background-color: #000;">
		<canvas width="800" height="600" id="canvo">
		</canvas>
<script>
const ca = document.getElementById("canvo");

const ctx = ca.getContext("2d");

console.log("damn!");

function tick(){
	return Date.now()
}

class frd {
	constructor(relative,fixed){
		this.fixed = fixed;
		this.relative = relative;
	}
}

class rDesc {
	constructor(offset,x,y,width,height,onesided,color,offset2,thr=0) {
		this.offset = offset*(Math.PI/2);
		this.x = x.fixed;
		this.xoff = x.relative
		this.y = y;
		this.width = width;
		this.height = height;
		this.onesided = onesided;
		this.color = color;
		this.offset2 = offset2;
		this.showthreshold = thr;
	}
	damna(context,r) {
		if (Math.sin(r+this.offset+this.offset2)>this.showthreshold || !this.onesided) {
			ctx.fillStyle = this.color;
			let w = Math.sin(r+this.offset+this.offset2)*this.width;
			ctx.fillRect(this.x-w/2-Math.sin(r+this.offset2)*this.xoff,this.y,w,this.height);
		}
	}
}

damn = [
	new rDesc(1,   new frd(60,400), 200, 60, 40, true, "rgb(102,22,24)", 0),
	new rDesc(1.1,   new frd(60,400), 200, 40, 40, true, "rgb(102,22,24)", 0.7),
	new rDesc(0.9,   new frd(60,400), 200, 40, 40, true, "rgb(102,22,24)", -0.7),
	new rDesc(1.1, new frd(60,400), 200, 10, 35, true, "rgb(102,22,24)", 1.7),
	new rDesc(0.9, new frd(60,400), 200, 10, 35, true, "rgb(102,22,24)", -1.7),
	
	new rDesc(1,   new frd(60,400), 234, 32, 22, true, "#222",        -2.6), // right eye glass
	new rDesc(1,   new frd(60,400), 235, 30, 20, true, "#FCF5F7",        -2.6), // right eye
	new rDesc(1,   new frd(60,400), 243, 3, 4, true, "#161413",        -2.6), // right eye pupil
	
	new rDesc(1,   new frd(70,400), 240, 25, 20, true, "rgb(255,187,164)",Math.PI), // nose front
	new rDesc(0,   new frd(65,400), 240, 11, 20, true, "rgb(245,180,164)",Math.PI-.13,.75), // nose right
	new rDesc(2,   new frd(65,400), 240, 11, 20, true, "rgb(245,180,164)",Math.PI+.13,.75), // nose left
	
	new rDesc(1,   new frd(60,400), 240, 38, 1, true, "#222",Math.PI), // glass twig
	
	new rDesc(1,   new frd(60,400), 234, 32, 22, true, "#222",        2.6), // left eye glass
	new rDesc(1,   new frd(60,400), 235, 30, 20, true, "#FCF5F7",        2.6), // left eye
	new rDesc(1,   new frd(60,400), 243, 3, 4, true, "#161413",        2.6), // left eye pupil
	
	new rDesc(1,   new frd(85,400), 280, 60, 5, true, "#000",Math.PI), // mouth
	
	new rDesc(2,   new frd(85,400), 310, 11, 25, true, "rgb(245,180,164)",Math.PI+.07,.5), // right chin
	new rDesc(1,   new frd(90,400), 310, 25, 25, true, "rgb(255,187,164)",Math.PI-.17), // left chin ball
	new rDesc(1,   new frd(90,400), 310, 25, 25, true, "rgb(255,187,164)",Math.PI+.17), // right chin ball
	new rDesc(0,   new frd(85,400), 310, 11, 25, true, "rgb(245,180,164)",Math.PI-.27,.5), // left chin
]

function yah(){
	ctx.fillStyle = "rgb(0,0,0)";
	ctx.fillRect(0,0,800,600)
	
	let r = tick()*0.31847133758*0.006;
	
	ctx.fillStyle = "rgb(245,187,164)";
	ctx.fillRect(340, 200, 120, 190);
	ctx.fillRect(400-55+Math.sin(r)*30, 260, 110, 130);
	
	ctx.fillStyle = "rgb(102,22,24)";
	ctx.fillRect(340, 200, 120, 20);
	
	/*if (Math.sin(r+Math.PI/2)>0) {
		let w = Math.sin(r-Math.PI/2)*80;
		ctx.fillRect(400-w/2-Math.sin(r)*60, 200, w, 35);
	}*/
	
	damn.forEach((rd)=>{
		rd.damna(ctx,r);
	})
	
	window.requestAnimationFrame(yah);
}

window.requestAnimationFrame(yah);
</script>
<script>
const pageInfo = {
	width: "800px",
	height: "600px",
	title: document.title,
	icon: '/media/Apps/peter.png'
};
parent.postMessage("PI:"+JSON.stringify(pageInfo),'*');
</script>
	</body>
</html>